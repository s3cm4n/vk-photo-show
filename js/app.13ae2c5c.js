(function(t){function e(e){for(var r,s,i=e[0],c=e[1],l=e[2],p=0,d=[];p<i.length;p++)s=i[p],n[s]&&d.push(n[s][0]),n[s]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(t[r]=c[r]);u&&u(e);while(d.length)d.shift()();return a.push.apply(a,l||[]),o()}function o(){for(var t,e=0;e<a.length;e++){for(var o=a[e],r=!0,i=1;i<o.length;i++){var c=o[i];0!==n[c]&&(r=!1)}r&&(a.splice(e--,1),t=s(s.s=o[0]))}return t}var r={},n={app:0},a=[];function s(e){if(r[e])return r[e].exports;var o=r[e]={i:e,l:!1,exports:{}};return t[e].call(o.exports,o,o.exports,s),o.l=!0,o.exports}s.m=t,s.c=r,s.d=function(t,e,o){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(s.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)s.d(o,r,function(e){return t[e]}.bind(null,r));return o},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="/vk-photo-show/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],c=i.push.bind(i);i.push=e,i=i.slice();for(var l=0;l<i.length;l++)e(i[l]);var u=c;a.push([0,"chunk-vendors"]),o()})({0:function(t,e,o){t.exports=o("56d7")},"034f":function(t,e,o){"use strict";var r=o("64a9"),n=o.n(r);n.a},"287b":function(t,e,o){},"56d7":function(t,e,o){"use strict";o.r(e);o("cadf"),o("551c"),o("f751"),o("097d");var r=o("2b0e"),n=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("v-app",{attrs:{id:"app"}},[o("main",[o("div",{staticClass:"header"},[t._v("VK Photo Show v"+t._s(t.v))]),o("Main")],1)])},a=[],s=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"text-xs-center wrapper"},[o("div",[o("v-dialog",{attrs:{width:"700"},model:{value:t.dialog,callback:function(e){t.dialog=e},expression:"dialog"}},[o("v-card",[o("v-card-title",{staticClass:"headline",attrs:{"primary-title":""}},[t._v("Вход по паролю")]),o("v-card-text",[o("v-form",[o("v-text-field",{attrs:{label:"Логин"},model:{value:t.login,callback:function(e){t.login=e},expression:"login"}}),o("v-text-field",{attrs:{type:"password",label:"Пароль"},model:{value:t.password,callback:function(e){t.password=e},expression:"password"}}),o("v-btn",{attrs:{color:"success"},on:{click:t.passwordLogin}},[t._v("Войти")])],1)],1)],1)],1)],1),o("v-container",{staticStyle:{"padding-top":"0"},attrs:{fluid:"","grid-list-xl":""}},[o("v-layout",{attrs:{row:"",wrap:""}},[o("v-flex",{attrs:{md12:"",xs12:""}},[o("v-card",[o("v-subheader",[t._v("Ваш аккаунт")]),o("v-card-text",[o("v-layout",{attrs:{row:""}},[o("v-flex",{attrs:{xs9:""}},[o("v-form",{staticClass:"text-xs-left"},[o("div",[o("v-text-field",{staticStyle:{"max-width":"300px","padding-bottom":"0px","margin-bottom":"0px"},attrs:{label:"Токен",required:""},on:{change:t.tokenUpdated},model:{value:t.token,callback:function(e){t.token=e},expression:"token"}}),o("a",{on:{click:function(e){t.dialog=!0}}},[t._v("или вход через логин и пароль")])],1),o("v-text-field",{attrs:{value:t.myself&&t.myself.first_name+" "+t.myself.last_name||"",label:"Имя",readonly:"",disabled:""}}),0===t.inittingStage?o("v-btn",{attrs:{color:"success"},on:{click:t.init}},[t._v("Войти")]):o("v-btn",{attrs:{color:"success",disabled:""}},[t._v("Войти")]),1===t.inittingStage?o("v-progress-circular",{attrs:{indeterminate:"",color:"primary"}}):t._e()],1)],1),o("v-flex",{attrs:{xs3:""}},[o("v-img",{staticClass:"round",attrs:{"aspect-ratio":"1",contain:"",src:t.myself&&t.myself.photo_200||"https://placehold.jp/100x100.png"}})],1)],1),o("v-alert",{attrs:{value:t.error,type:"error"}},[t._v(t._s(t.error))])],1)],1)],1)],1),o("v-layout",{attrs:{row:"",wrap:""}},[o("v-flex",{attrs:{md12:"",xs12:""}},[o("v-card",[o("v-subheader",[t._v("Фото")]),o("div",[o("v-tabs",{attrs:{centered:"","show-arrows":""},model:{value:t.activeTab,callback:function(e){t.activeTab=e},expression:"activeTab"}},[o("v-tabs-slider",{attrs:{color:"blue"}}),t._l(t.photos,function(e,r){return o("v-tab",{key:""+t.chats[r].peer_id},[t._v(t._s(t.chats[r].peerInfo.first_name)+" "+t._s(t.chats[r].peerInfo.last_name))])}),o("v-tabs-items",t._l(t.photos,function(e,r){return o("v-tab-item",{key:""+t.chats[r].peer_id},[o("v-layout",[o("v-flex",[o("v-container",{attrs:{"grid-list-sm":"",fluid:""}},[t.chats[r].downloaded?o("v-layout",{attrs:{row:"",wrap:""}},[t._l(t.photos[r].slice(0,t.chats[r].currentMax),function(e,r){return o("v-flex",{key:r+"_"+e.id,attrs:{xs2:"","d-flex":""}},[o("v-card",{staticClass:"d-flex",attrs:{flat:"",tile:""}},[o("v-img",{staticClass:"grey lighten-2",attrs:{src:e.lowRes,"lazy-src":e.lowRes,"aspect-ratio":"1"},on:{click:function(e){t.index=r,t.lbVisible=!0}},scopedSlots:t._u([{key:"placeholder",fn:function(){return[o("v-layout",{attrs:{"fill-height":"","align-center":"","justify-center":"","ma-0":""}},[o("v-progress-circular",{attrs:{indeterminate:"",color:"grey lighten-5"}})],1)]},proxy:!0}],null,!0)})],1)],1)}),o("VueEasyLightbox",{attrs:{visible:t.lbVisible,imgs:t.photos[r].map(function(t){return t.highRes}),index:t.index},on:{hide:function(e){t.lbVisible=!t.lbVisible}}})],2):o("v-layout",{attrs:{"fill-height":"","align-center":"","justify-center":"","ma-0":""}},[o("v-progress-circular",{attrs:{indeterminate:""}})],1)],1),t.chats[r].downloaded&&t.photos[r].length>t.chats[r].currentMax?o("v-btn",{attrs:{color:"success"},on:{click:function(e){t.chats[r].currentMax+=12}}},[t._v("Больше")]):t._e()],1)],1)],1)}),1)],2)],1)],1)],1)],1)],1)],1)},i=[],c=(o("7f7f"),o("ac6a"),o("28a5"),o("825a")),l=o("bc3a"),u=o.n(l),p=(o("96cf"),o("3b8d")),d=(o("456d"),o("f2e8")),f=o.n(d),h=o("34a9"),v=o.n(h),g={token:null,loadVK:function(t,e,o){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:console.error,n="https://api.vk.com/method/".concat(t,"?access_token=").concat(this.token,"&v=5.1&https=1&").concat(Object.keys(e).reduce(function(t,o){return t.push(o+"="+encodeURIComponent(e[o])),t},[]).join("&"));f()(n,null,function(t,e){e.error&&console.error("load",n,e.error),t?r(t):o(e.response)})}};g.aloadVK=function(){var t=Object(p["a"])(regeneratorRuntime.mark(function t(e,o){var r,n;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return r="https://api.vk.com/method/".concat(e,"?access_token=").concat(this.token,"&v=5.1&https=1&").concat(Object.keys(o).reduce(function(t,e){return t.push(e+"="+encodeURIComponent(o[e])),t},[]).join("&")),t.next=3,v()(r,null,function(t,e){return t?(console.error(t),t):e}).promise;case 3:if(n=t.sent,!n.error){t.next=7;break}return console.error("aload",r,n.error),t.abrupt("return",n.error);case 7:return t.abrupt("return",n.response);case 8:case"end":return t.stop()}},t,this)}));return function(e,o){return t.apply(this,arguments)}}();var m=g,_=o("5118"),b={name:"Main",data:function(){return{activeTab:null,dialog:!1,token:null,myself:null,inittingStage:0,error:!1,login:"",password:"",chats:[],photos:[],peerInfoByChatId:{},lbVisible:!1,index:0}},created:function(){},methods:{maxRes:function(t){var e="photo_130 photo_604 photo_807 photo_1280 photo_2560".split(" "),o=[0,0];return e.forEach(function(e){t[e]&&(o[0]=t[e])}),t.photo_130?o[1]=t.photo_130:e.reverse().forEach(function(e){t[e]&&(o[1]=t[e])}),o},passwordLogin:function(){var t=this;this.dialog=!1,this.inittingStage=1,u.a.post("https://apidog.ru/api/v2/apidog.authorize",{login:this.login,password:this.password,application:1}).then(function(e){return e=e.data,73===e.response.errorId?(t.error="ВК просит ввести капчу, а я эту функцию не сделал. Ждите.",void t.tokenUpdated()):e.response.userAccessToken?(t.token=e.response.userAccessToken,t.tokenUpdated(),void t.init()):(t.error="Неверная пара логин/пароль.",void t.tokenUpdated())})},tokenUpdated:function(){this.inittingStage=0,this.myself=null,this.photos=[],m.token=this.token},init:function(){var t=this;this.error=!1,this.inittingStage=1,m.loadVK("users.get",{fields:"photo_50, photo_100, photo_200"},function(e){if(!e)return t.error="Токен не валиден или недостаточно прав.",void t.tokenUpdated();t.myself=e[0],m.uid=e[0].id,m.myself=e[0]},function(e){t.error="Ошибка сети (".concat(e,")"),t.tokenUpdated()});for(var e=[],o=0;o<25;o++)e.push("API.messages.getConversations({offset: ".concat(40*o,", count:40, extended: 1, v:5.80})"));m.loadVK("execute",{code:"return["+e.join(",")+"];"},function(e){if(!e)return t.error="Токен не валиден или недостаточно прав.",void t.tokenUpdated();for(var o=[],r=0;r<e.length;r++)for(var n=e[r],a=0;a<n.items.length;a++){var s=n.items[a].conversation.peer.id,i=n.items[a].conversation;if("user"===i.peer.type){for(var c=0;c<n.profiles.length;c++)if(n.profiles[c].id===s){o.push({type:"user",peer_id:s,last_message:n.items[a].last_message,peerInfo:n.profiles[c],selected:!0}),n.items[a].peerInfo=n.profiles[c];break}}else if("group"===i.peer.type){for(var l=0;l<n.groups.length;l++)if(-n.groups[l].id===i.peer.id){var u={id:-n.groups[l].id,last_name:"",first_name:n.groups[l].name,photo_100:n.groups[l].photo_100,photo_50:n.groups[l].photo_50};o.push({type:"group",peer_id:s,last_message:n.items[a].last_message,peerInfo:u,selected:!0}),n.items[a].peerInfo=u;break}}else if("chat"===i.peer.type){var p={id:i.peer.id,last_name:"",first_name:i.chat_settings.title,photo_100:i.chat_settings.photo?i.chat_settings.photo.photo_100:"https://vk.com/images/camera_100.png?ava=1",photo_50:i.chat_settings.photo?i.chat_settings.photo.photo_50:"https://vk.com/images/camera_50.png?ava=1"};o.push({type:"chat",peer_id:i.peer.id,last_message:n.items[a].last_message,peerInfo:p,selected:!0})}o[o.length-1].downloaded=!1,o[o.length-1].currentMax=12}t.chats=o,t.chats=t.chats.slice(0,20),t.inittingStage=3;for(var d=0;d<t.chats.length;d++)t.peerInfoByChatId[t.chats[d].peer_id]=t.chats[d].peerInfo;t.showPhotos()},function(e){t.error="Ошибка сети (".concat(e,")"),t.tokenUpdated()})},loadAllAttachments:function(t,e){var o=[],r=function t(e,r,a){if(!1!==r){for(var s=["var a; var ans =[];"],i=0,c=21;i<c;++i)s.push("a = API.messages.getHistoryAttachments({peer_id:".concat(e,",v:5.2,start_from:a.next_from,count:200, media_type: 'photo'}); ans.push(a.items);"));m.loadVK("execute",{code:s.join(";")+"; return ans;"},function(s){(s=n(s)).isFull?Object(_["setTimeout"])(function(){t(e,r+5e3,a)},400):a(o)})}},n=function(t){var e=[],r=!0;t.forEach(function(t){Array.isArray(t)&&(e=e.concat(t))}),r=t[t.length-1]&&200==t[t.length-1].length,t=null;for(var n=0;n<e.length;n++)o.push(e[n].photo);return{messages:e,isFull:r}};r(t,0,e)},showPhotos:function(){for(var t=this,e=function(e){t.photos.push(null),Object(_["setTimeout"])(function(){return t.loadAllAttachments(t.chats[e].peer_id,function(o){t.chats[e].downloaded=!0,t.photos[e]=o;for(var r=0;r<t.photos[e].length;r++)t.photos[e][r].highRes=t.maxRes(t.photos[e][r])[0],t.photos[e][r].lowRes=t.maxRes(t.photos[e][r])[1]})},1e3*e)},o=0;o<this.chats.length;o++)e(o)}},components:{VueEasyLightbox:c["a"]}},y=b,x=(o("c266"),o("2877")),k=Object(x["a"])(y,s,i,!1,null,null,null),w=k.exports,j={name:"app",components:{Main:w},computed:{v:function(){return"0.1.0"}}},I=j,O=(o("034f"),Object(x["a"])(I,n,a,!1,null,null,null)),S=O.exports,V=o("ce5b"),C=o.n(V);o("bf40"),o("d1e7");r["default"].use(c["a"]),r["default"].use(C.a,{iconfont:"md"}),r["default"].config.productionTip=!1,new r["default"]({render:function(t){return t(S)}}).$mount("#app")},"64a9":function(t,e,o){},c266:function(t,e,o){"use strict";var r=o("287b"),n=o.n(r);n.a}});
//# sourceMappingURL=app.13ae2c5c.js.map